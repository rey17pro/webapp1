<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAIMS Vlog Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --maims-maroon: #800000; }
        body { background: #f8f9fa; }
        .bg-maims { background: var(--maims-maroon); color: white; }
        .page { display: none; padding: 20px 0; }
        .active { display: block; }
        .vlog-card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        iframe { width: 100%; aspect-ratio: 16/9; border: none; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-maims shadow-sm">
    <div class="container">
        <span class="navbar-brand fw-bold" style="cursor:pointer" onclick="window.location.reload()">MAIMS VLOGS</span>
        <button id="navBtn" class="btn btn-outline-light btn-sm" onclick="showPage('login')">Admin Login</button>
    </div>
</nav>

<div class="container mt-4">
    <div id="home" class="page active">
        <h2 class="text-center mb-4">Latest Vlogs</h2>
        <div id="vlogGrid" class="row"></div>
    </div>

    <div id="login" class="page">
        <div class="row justify-content-center">
            <div class="col-md-4 card p-4 shadow">
                <h4 class="text-center">Admin Access</h4>
                <input type="email" id="email" class="form-control my-2" placeholder="Email">
                <input type="password" id="password" class="form-control my-2" placeholder="Password">
                <button class="btn btn-danger w-100" onclick="handleLogin()">Sign In</button>
                <button class="btn btn-link w-100 mt-2" onclick="showPage('home')">Back</button>
            </div>
        </div>
    </div>

    <div id="admin" class="page">
        <div class="d-flex justify-content-between mb-4">
            <h3>Admin Dashboard</h3>
            <button class="btn btn-secondary btn-sm" onclick="handleLogout()">Logout</button>
        </div>
        <div class="card p-3 mb-4">
            <h5>Add New Vlog</h5>
            <input type="text" id="vTitle" class="form-control mb-2" placeholder="Title">
            <input type="text" id="vUrl" class="form-control mb-2" placeholder="YouTube Link">
            <button class="btn btn-success" onclick="addVlog()">Publish to Site</button>
        </div>
        <div id="adminList"></div>
    </div>
</div>

<script>
    const SUPABASE_URL = "https://nplghkofeizbzsysqeew.supabase.co"; 
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wbGdoa29mZWl6YnpzeXNxZWV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwMzA0MzAsImV4cCI6MjA4NTYwNjQzMH0.D3mzyC4zsRwRMpWXdCulRqUwoPAKBQLFjt--sRZagC0";
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // FIX: Function to show pages
    function showPage(pageId) {
        console.log("Showing page: " + pageId);
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
    }

    async function handleLogin() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        const { error } = await supabase.auth.signInWithPassword({ email: e, password: p });
        if (error) alert("Error: " + error.message);
        else checkStatus();
    }

    async function handleLogout() {
        await supabase.auth.signOut();
        window.location.reload();
    }

    async function checkStatus() {
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            showPage('admin');
            document.getElementById('navBtn').innerText = "Dashboard";
            document.getElementById('navBtn').onclick = () => showPage('admin');
            loadAdminList();
        } else {
            loadVlogs();
        }
    }

    async function loadVlogs() {
        const { data } = await supabase.from('vlogs').select('*');
        if (data) {
            document.getElementById('vlogGrid').innerHTML = data.map(v => `
                <div class="col-md-6 col-lg-4">
                    <div class="vlog-card">
                        <iframe src="
